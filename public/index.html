<!DOCTYPE html>
<html lang="pt-BR">
<head><link rel="manifest" href="/manifest.json" />
<script type="module" src="/src/main.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Chamados â€“ AmbulÃ¢ncia Municipal â€“ GuaiÃ§ara/SP</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
/* -------------------- LAYOUT --------------------*/

body {
    margin: 0;
    background: #f2f2f2;
    font-family: Arial, sans-serif;
}

/* CabeÃ§alho */
header {
    background: #b50000;
    color: white;
    padding: 35px 20px;
    text-align: center;
    font-size: 28px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

/* Container */
.container {
    margin: 25px auto;
    max-width: 1100px;
    background: #ffffff;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

input, select, textarea {
    width: 100%;
    padding: 10px;
    margin: 6px 0 15px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
}

button {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    margin-right: 10px;
    font-weight: bold;
}

.btn-add { background: #b50000; color: white; }
.btn-urgencia { background: #ffcc00; color: black; border: 2px solid #b50000; }
.btn-del { background: #444; color: white; }

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
    background: white;
    border-radius: 12px;
    overflow: hidden;
}

th {
    background: #b50000;
    color: white;
    padding: 12px;
    font-size: 16px;
}

td {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

tr:hover {
    background: #ffe4e4;
}

/* CHAT */
.chat-box {
    margin-top: 30px;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.message {
    padding: 10px 12px;
    background: #f7f7f7;
    margin-bottom: 10px;
    border-radius: 8px;
}

footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 45px;
    background: #ffffff;
    border-top: 2px solid #ccc;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 20px;
    font-size: 14px;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.15);
}

.status-online { color: green; font-weight: bold; }
.status-offline { color: red; font-weight: bold; }

</style>
</head>

<body>

<header>ðŸš‘ REGISTRO DE CHAMADOS â€“ AMBULÃ‚NCIA MUNICIPAL â€“ GUAIÃ‡ARA/SP</header>

<div class="container">

<h2>Novo Chamado</h2>

<label>Data</label>
<input type="date" id="data">

<label>HorÃ¡rio</label>
<input type="time" id="horario">

<label>Paciente</label>
<input type="text" id="paciente">

<label>EndereÃ§o</label>
<input type="text" id="endereco">

<label>Destino</label>
<input type="text" id="destino">

<label>Motorista</label>
<input type="text" id="motorista">

<label>ObservaÃ§Ãµes</label>
<textarea id="obs" rows="3"></textarea>

<button class="btn-add" onclick="adicionarChamado()">Adicionar</button>
<button class="btn-urgencia" onclick="marcarUrgencia()">âš  URGÃŠNCIA</button>
<button class="btn-del" onclick="excluirSelecionados()">Excluir Selecionados</button>

<h2>Chamados</h2>

<table>
<thead>
    <tr>
        <th>Sel</th>
        <th>Data</th>
        <th>Hora</th>
        <th>Paciente</th>
        <th>EndereÃ§o</th>
        <th>Destino</th>
        <th>Motorista</th>
        <th>ObservaÃ§Ãµes</th>
    </tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>

<div class="chat-box">
    <h2>Chat Interno</h2>
    <input type="text" id="chatMsg" placeholder="Digite uma mensagem..." onkeydown="if(event.key==='Enter') enviarMsg()">
    <button class="btn-add" onclick="enviarMsg()">Enviar</button>
    <div id="chatArea"></div>
</div>

</div>

<!-- RODAPÃ‰ -->
<footer>
    <div id="statusConexao">Status: <span class="status-offline">Offline</span></div>
    <div id="usuarioLogado">UsuÃ¡rio: â€”</div>
    <div id="ultimaSync">Ãšltima sync: â€”</div>

    <!-- ðŸ”´ AQUI estÃ¡ o botÃ£o SAIR -->
    <button onclick="logout()" style="background:#222;color:white;padding:6px 12px;border-radius:6px;">Sair</button>
</footer>

<script>
/* FIREBASE CONFIG */
const firebaseConfig = {
    apiKey: "AIzaSyCoSPb1WMrH2MMuM1AdR2YEAX60XVgO3WE",
    authDomain: "registro-ambulancia192.firebaseapp.com",
    projectId: "registro-ambulancia192",
    storageBucket: "registro-ambulancia192.firebasestorage.app",
    messagingSenderId: "549498386461",
    appId: "1:549498386461:web:94d6ac364a54a7d4216ef4",
    measurementId: "G-NM7EQL6E83",
    databaseURL: "https://registro-ambulancia192-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* ðŸ”’ Impede acesso sem login */
auth.onAuthStateChanged(user => {
    if (!user) {
        window.location.href = "login.html";
    } else {
        document.getElementById("usuarioLogado").innerHTML = "UsuÃ¡rio: " + user.email;
    }
});

/* LOGOUT */
window.logout = function () {
    auth.signOut().then(() => window.location.href = "login.html");
};

/* FUNÃ‡Ã•ES DO SISTEMA */

let urgenciaAtivada = false;
function marcarUrgencia() { urgenciaAtivada = true; alert("Chamado marcado como URGÃŠNCIA."); }

function adicionarChamado() {
    db.ref("chamados").push({
        data: data.value, horario: horario.value, paciente: paciente.value,
        endereco: endereco.value, destino: destino.value, motorista: motorista.value,
        obs: obs.value, urgencia: urgenciaAtivada, createdBy: auth.currentUser.uid
    });
    urgenciaAtivada = false;
}

db.ref("chamados").on("value", snap => {
    corpoTabela.innerHTML = "";
    snap.forEach(item => {
        const c = item.val();
        const id = item.key;
        corpoTabela.innerHTML += `
        <tr>
            <td><input type="checkbox" data-id="${id}"></td>
            <td>${c.data}</td>
            <td>${c.horario}</td>
            <td style="${c.urgencia?'background:#ffcc00;font-weight:bold;':''}">${c.paciente}</td>
            <td>${c.endereco}</td>
            <td>${c.destino}</td>
            <td>${c.motorista}</td>
            <td>${c.obs}</td>
        </tr>`;
    });
});

function excluirSelecionados() {
    document.querySelectorAll("input[type=checkbox]:checked").forEach(chk => {
        db.ref("chamados/" + chk.dataset.id).remove();
    });
}

/* CHAT */
function enviarMsg() {
    if (!chatMsg.value) return;
    db.ref("chat").push({ msg: chatMsg.value, uid: auth.currentUser.uid, hora: new Date().toLocaleTimeString() });
    chatMsg.value = "";
}

db.ref("chat").on("value", snap => {
    chatArea.innerHTML = "";
    snap.forEach(item => {
        const m = item.val();
        chatArea.innerHTML += `<div class="message"><b>${m.hora}</b> â€” ${m.msg}</div>`;
    });
});

</script>

</body>
</html>
